<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vot√≥metro 2026: Resultados Detallados</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --bg: #FFF0F5;
            --primary: #FFB7C5; 
            --primary-dark: #FF9EAA;
            --accent: #6c5ce7; 
            --text: #2d3436;
            --card: #ffffff;
            --info-bg: #E3F2FD;
            --info-border: #2196F3;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#dfe6e9 1.5px, transparent 1.5px);
            background-size: 25px 25px;
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        #app {
            background: var(--card);
            width: 100%;
            max-width: 900px;
            border-radius: 40px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(108, 92, 231, 0.15);
            border: 8px solid white;
        }

        h1 { color: var(--accent); text-align: center; font-weight: 900; font-size: 2.5em; margin: 0; }
        .subtitle { text-align: center; color: #636e72; font-size: 1.1em; margin-bottom: 20px; }

        .btn-main {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 var(--primary-dark);
            font-weight: 800;
            display: block;
            margin: 20px auto;
            transition: 0.2s;
        }
        .btn-main:active { transform: translateY(6px); box-shadow: none; }
        
        .btn-pdf {
            background: #2d3436; color: white; border: none; padding: 12px 30px;
            font-size: 1em; border-radius: 50px; cursor: pointer; font-weight: 700;
            display: block; margin: 10px auto;
        }

        /* README BOX */
        .readme-container {
            text-align: left; background: #F8F9FA; border: 2px solid #E9ECEF;
            border-radius: 20px; padding: 20px; margin: 20px 0; font-size: 0.95em;
        }
        .readme-title {
            color: var(--accent); font-weight: 800; margin-bottom: 10px; display: block;
            font-size: 1.1em; border-bottom: 2px solid #eee; padding-bottom: 5px;
        }
        .readme-list { padding-left: 20px; margin: 10px 0; }
        .readme-list li { margin-bottom: 12px; line-height: 1.4; }

        /* Preguntas */
        .option-btn {
            background: white; border: 2px solid #dfe6e9; border-radius: 20px;
            padding: 15px 20px; width: 100%; margin-bottom: 12px; text-align: left;
            cursor: pointer; transition: all 0.2s; font-size: 1em; color: var(--text);
            font-weight: 600; line-height: 1.4; display: flex; align-items: center;
        }
        .option-btn:hover {
            border-color: var(--accent); background: #f8faff; transform: translateX(5px);
        }
        .opt-icon { margin-right: 15px; font-size: 1.2em; min-width: 30px; text-align: center; }

        /* Resultados */
        .candidate-card {
            border: 2px solid #f1f2f6; border-radius: 25px; padding: 25px;
            margin-bottom: 25px; background: #fff; position: relative;
        }

        .match-badge {
            position: absolute; top: -15px; right: 20px; background: var(--accent);
            color: white; padding: 8px 15px; border-radius: 20px; font-weight: 800;
        }

        .section-title { font-size: 0.8em; text-transform: uppercase; font-weight: 800; margin-top: 15px; }
        .box-trayectoria { background: #FFFDE7; border-left: 5px solid #FBC02D; padding: 12px; border-radius: 10px; font-size: 0.95em; color: #5D4037; }
        .box-promesa { background: #E8F5E9; border-left: 5px solid #4CAF50; padding: 12px; border-radius: 10px; font-size: 0.95em; color: #1B5E20; }

        /* Breakdown Box (Nuevo) */
        .breakdown-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; border-bottom: 1px solid #eee; font-size: 0.95em;
        }
        .breakdown-count {
            background: #2d3436; color: white; padding: 2px 10px;
            border-radius: 10px; font-weight: bold; font-size: 0.9em;
        }

        /* Gr√°fico */
        #chart {
            position: relative; height: 450px; width: 100%;
            border: 3px dashed #b2bec3; border-radius: 30px; margin: 30px 0;
            background: rgba(255,255,255,0.7);
        }
        .dot {
            position: absolute; width: 20px; height: 20px; border-radius: 50%;
            transform: translate(-50%, -50%); z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .label {
            position: absolute; background: rgba(45, 52, 54, 0.9); color: white;
            padding: 4px 8px; border-radius: 5px; font-size: 11px;
            top: -35px; left: 50%; transform: translateX(-50%);
            white-space: nowrap; opacity: 0; transition: 0.2s;
            pointer-events: none; z-index: 100;
        }
        .dot:hover .label { opacity: 1; }
        .printing-mode .label { opacity: 1 !important; background: rgba(45, 52, 54, 1) !important; border: 1px solid white; }
        .user-dot { width: 30px; height: 30px; background: #FF007F; border: 4px solid white; box-shadow: 0 0 20px rgba(255, 0, 127, 0.4); z-index: 50; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    </style>
</head>
<body>

<div id="app">
    <div id="screen-start">
        <h1>Vot√≥metro 2026 üá®üá¥</h1>
        <div class="subtitle">Descubre tu afinidad real con los candidatos.</div>
        
        <div class="readme-container">
            <span class="readme-title">ü§ñ Transparencia e IA</span>
            <p>Este aplicativo usa Inteligencia Artificial para garantizar imparcialidad:</p>
            <p><strong>No almacenamos datos personales ni registramos tus respuestas.</strong></p>
            <p><strong>No intentamos influir en tu intenci√≥n de voto. Los resultados se calculan autom√°ticamente a partir de tus respuestas.</strong></p>
            <span class="readme-title">‚ú® Caracter√≠sticas</span>
            <ul class="readme-list">
                <li><strong>Preguntas neutrales:</strong> Las preguntas y sus matices (4 opciones) fueron redactadas por IA para evitar sesgos personales.</li>
                <li><strong>C√°lculo matem√°tico (Promedio):</strong> Tu ubicaci√≥n en el mapa es un <strong>promedio matem√°tico</strong> de tus 15 respuestas. 
                    <br><em style="color:#666; font-size:0.9em;">(Ojo: Si respondes la mitad como extrema izquierda y la otra mitad como extrema derecha, el sistema te ubicar√° en el Centro, porque los extremos se anulan matem√°ticamente).</em></li>
                <li><strong>Ubicaci√≥n en el Espectro:</strong> La posici√≥n (X,Y) de los candidatos en el gr√°fico se determin√≥ mediante an√°lisis de datos p√∫blicos (votos en el congreso y planes de gobierno) procesados por IA.</li>
            </ul>
        </div>
        
        <button class="btn-main" onclick="start()">Comenzar Test</button>
    </div>

    <div id="screen-quiz" class="hidden">
        <div style="display:flex; justify-content:space-between; font-weight:bold; color:var(--accent); margin-bottom:10px;">
            <span id="q-progress">Pregunta 1/15</span>
            <span>2026</span>
        </div>
        
        <div id="q-box" class="fade-in">
            <h2 id="q-text" style="color:#2d3436; margin-top:0; font-size:1.4em;">...</h2>
            <div id="options-box"></div>
        </div>
    </div>

    <div id="screen-results" class="hidden">
        <div id="printable-area" style="padding:20px; background:white; border-radius:20px;">
            <h1 style="color:var(--accent);">Mis Resultados 2026</h1>
            <p style="text-align:center; color:#888;">Generado por Vot√≥metro IA</p>

            <div id="chart" style="position:relative;">
  <!-- ejes -->
  <div style="position:absolute; top:50%; left:0; width:100%; height:2px; background:#dfe6e9;"></div>
  <div style="position:absolute; left:50%; top:0; height:100%; width:2px; background:#dfe6e9;"></div>

  <!-- X axis labels (izq/der) -->
  <span class="axis-label"
        style="position:absolute; left:12px; top:50%; transform:translateY(-50%) rotate(-90deg); transform-origin:left top;">
    Izquierda / Estado
  </span>

  <span class="axis-label"
        style="position:absolute; right:12px; top:50%; transform:translateY(-50%) rotate(90deg); transform-origin:right top;">
    Derecha / Mercado
  </span>

  <!-- Y axis labels (arriba/abajo) -->
  <span class="axis-label"
        style="position:absolute; top:10px; left:50%; transform:translateX(-50%); color:#6c5ce7;">
    ‚¨ÜÔ∏è Progresista
  </span>

  <span class="axis-label"
        style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%); color:#6c5ce7;">
    ‚¨áÔ∏è Conservador
  </span>

  <div id="dots-layer"></div>
</div>


            <div style="background:#f8f9fa; border-radius:20px; padding:20px; margin-bottom:30px; border:2px solid #eee;">
                <h3 style="margin-top:0;">üîç Desglose: ¬øQui√©n gan√≥ tu voto en cada pregunta?</h3>
                <p style="font-size:0.9em; color:#666; margin-bottom:15px;">
                    Aunque el gr√°fico muestra tu promedio general, aqu√≠ te mostramos <strong>en cu√°ntas preguntas espec√≠ficas coincidiste exactamente</strong> con la postura de cada candidato:
                </p>
                <div id="breakdown-box"></div>
            </div>

            <h3>üèÜ Top 3 Afinidades (Promedio General)</h3>
            <div id="matches-box"></div>
        </div>
        <h3 style="margin-top:30px;">üéØ Candidatos con coincidencias (pregunta a pregunta)</h3>
        <p style="font-size:0.9em; color:#666; margin-top:-10px;">
            Aqu√≠ se muestran solo los candidatos con los que coincidiste en al menos 1 pregunta (la coincidencia se calcula por cercan√≠a de tu respuesta).
        </p>
        <div id="coincidences-box"></div>


        <div style="margin-top:30px; text-align:center;">
            <button class="btn-pdf" onclick="generatePDF()">üìÑ Descargar Resultados (PDF)</button>
            <button class="btn-main" onclick="location.reload()" style="background:transparent; color:#666; box-shadow:none; border:2px solid #eee;">Reiniciar</button>
        </div>
    </div>
</div>

<script>
    // ================= DATA CANDIDATOS =================
    const candidates = [
        { name: "Abelardo de la Espriella", party: "Derecha Radical", color: "#2d3436", x: 95, y: 5, trayectoria: "Realidad: Abogado litigante. Nunca ha tenido cargos p√∫blicos. Defiende la reducci√≥n extrema del Estado.", promesas: "Propone: Cerrar 13 ministerios, despedir a miles de funcionarios y eliminar impuestos." },
        { name: "Iv√°n Cepeda", party: "Pacto Hist√≥rico", color: "#f1c40f", x: 5, y: 95, trayectoria: "Realidad: Autor de la Ley de V√≠ctimas y defensor de los Acuerdos de Paz. coautor de la iniciativa legislativa en pro del Matrimonio igualitario y reconocimiento de familias diversas.", promesas: "Propone: Reforma agraria (entregar tierras), Asamblea Constituyente y Paz Total." },
        { name: "Paloma Valencia", party: "Centro Democr√°tico", color: "#2d3436", x: 85, y: 15, trayectoria: "Realidad: Senadora de oposici√≥n. Vot√≥ en contra del Acuerdo de Escaz√∫. Autora de leyes para el agro (Panela) y Estado Contigo (: programa de subsidios y acompa√±amiento para mujeres cabeza de hogar)", promesas: "Propone: Seguridad Democr√°tica 2.0, bonos para colegios privados y libertad econ√≥mica." },
        { name: "Vicky D√°vila", party: "Independiente", color: "#0984e3", x: 80, y: 25, trayectoria: "Realidad: Periodista. Se ha dedicado a denunciar esc√°ndalos de corrupci√≥n del gobierno actual.", promesas: "Propone: Un bloque de b√∫squeda contra corruptos y fortalecer la alianza con EE.UU." },
        { name: "Gustavo Bol√≠var", party: "Pacto Hist√≥rico", color: "#e74c3c", x: 10, y: 90, trayectoria: "Realidad: Exsenador. Promovi√≥ la legalizaci√≥n del cannabis y subsidios al agua.", promesas: "Propone: Educaci√≥n universitaria gratuita para todos y profundizar las reformas sociales." },
        { name: "Claudia L√≥pez", party: "Verde / Centro", color: "#00b894", x: 40, y: 70, trayectoria: "Realidad: Exalcaldesa de Bogot√°. Construy√≥ el Sistema de Cuidado y contrat√≥ el Metro.", promesas: "Propone: Enfocarse en 'hacer y no hablar', seguridad local y obras p√∫blicas." },
        { name: "Sergio Fajardo", party: "Centro", color: "#00cec9", x: 50, y: 60, trayectoria: "Realidad: Exgobernador enfocado en educaci√≥n y parques biblioteca. Gesti√≥n t√©cnica.", promesas: "Propone: Lucha contra la corrupci√≥n sin polarizaci√≥n y la educaci√≥n como motor." },
        { name: "Juan Daniel Oviedo", party: "Independiente", color: "#e17055", x: 60, y: 65, trayectoria: "Realidad: Exdirector del DANE. Se destac√≥ por su manejo t√©cnico de las estad√≠sticas.", promesas: "Propone: Gobernar con datos reales, sin ideolog√≠as extremas y gerencia eficiente." }
    ];

    // ================= PREGUNTAS DESCRIPTIVAS =================
    const questions = [
        { 
            t: "1. ¬øC√≥mo se debe solucionar el problema de la inseguridad?", 
            o: [
                { tx: "üî® Mano dura total: Construir megac√°rceles, militarizar las ciudades y cero beneficios a criminales.", x:95, y:5 },
                { tx: "üëÆ Autoridad y Tecnolog√≠a: Fortalecer a la polic√≠a y usar inteligencia, sin llegar a extremos autoritarios.", x:75, y:30 },
                { tx: "‚öñÔ∏è Justicia Social: El crimen baja si hay justicia eficaz y m√°s oportunidades de empleo.", x:50, y:60 },
                { tx: "üïäÔ∏è Paz Total: La prioridad es negociar con las bandas criminales para que se desmovilicen pac√≠ficamente.", x:5, y:95 }
            ] 
        },
        { 
            t: "2. ¬øQu√© tanto debe intervenir el Estado en la econom√≠a?", 
            o: [
                { tx: "üö´ Estado M√≠nimo: El Estado estorba. Hay que eliminar ministerios y dejar que el mercado libre decida todo.", x:100, y:null },
                { tx: "üíº Facilitador: El Estado debe ser peque√±o y ayudar a que los empresarios generen empleo.", x:70, y:null },
                { tx: "‚öñÔ∏è Regulador: Se necesita un Estado que vigile a las empresas para evitar abusos, econom√≠a mixta.", x:40, y:null },
                { tx: "üèõÔ∏è Estado Fuerte: El Estado debe planificar la econom√≠a y garantizar los derechos de todos por encima del mercado.", x:5, y:null }
            ] 
        },
        { 
            t: "3. ¬øQu√© hacemos con las EPS y el sistema de salud?", 
            o: [
                { tx: "üè• Defenderlas: El sistema actual funciona bien y el sector privado es m√°s eficiente que el p√∫blico.", x:90, y:null },
                { tx: "üîß Ajustarlas: Mantener las EPS pero vigilarlas m√°s estrictamente para que no roben recursos.", x:60, y:null },
                { tx: "üîÑ Modelo Mixto: Que el Estado maneje la plata directamente, pero cl√≠nicas privadas presten el servicio.", x:30, y:null },
                { tx: "üèõÔ∏è 100% P√∫blico: Eliminar las EPS. La salud es un derecho, no un negocio, y debe ser totalmente estatal.", x:5, y:null }
            ] 
        },
        { 
            t: "4. ¬øCu√°l es su postura frente a la explotaci√≥n de petr√≥leo y gas?", 
            o: [
                { tx: "üõ¢Ô∏è A favor de todo: Apoyo el Fracking y sacar todo el petr√≥leo posible para generar riqueza.", x:95, y:null },
                { tx: "üí∞ Pragm√°tico: Seguir explorando petr√≥leo de forma tradicional, pero sin hacer Fracking.", x:65, y:null },
                { tx: "üìâ Transici√≥n Gradual: No firmar nuevos contratos, pero respetar los que ya existen hasta que se acaben.", x:40, y:null },
                { tx: "üõë Prohibici√≥n: Hay que detener la exploraci√≥n ya mismo para salvar el planeta del cambio clim√°tico.", x:5, y:null }
            ] 
        },
        { 
            t: "5. ¬øCree que Colombia necesita una Asamblea Constituyente?", 
            o: [
                { tx: "üìú Jam√°s: La Constituci√≥n del 91 es sagrada y debemos protegerla, no cambiarla.", x:null, y:30 },
                { tx: "ü§∑ Innecesaria: Las reformas se pueden hacer a trav√©s del Congreso sin cambiar la Constituci√≥n.", x:null, y:50 },
                { tx: "ü§î Tal vez: Solo para reformar cosas puntuales como la Justicia, pero no una reforma total.", x:null, y:70 },
                { tx: "‚úä Urgente: Las instituciones actuales no sirven, hay que refundar el pa√≠s con una Constituyente.", x:null, y:95 }
            ] 
        },
        { 
            t: "6. ¬øC√≥mo se debe manejar la pobreza y los subsidios?", 
            o: [
                { tx: "üö´ Cero regalado: Los subsidios generan pereza. La gente sale de pobre trabajando.", x:100, y:null },
                { tx: "‚ö†Ô∏è Solo emergencias: Subsidios temporales solo para quienes sufren hambre o pobreza extrema.", x:70, y:null },
                { tx: "üíµ Renta B√°sica: Un ingreso garantizado para pobres, pero condicionado a que estudien o trabajen.", x:40, y:null },
                { tx: "ü§ù Universales: El Estado debe garantizar un sustento a todos los vulnerables como un derecho.", x:5, y:null }
            ] 
        },
        { 
            t: "7. ¬øCu√°l es la soluci√≥n al problema de las drogas?", 
            o: [
                { tx: "üî´ Guerra total: Prohibici√≥n absoluta, fumigaci√≥n a√©rea y c√°rcel para todos los involucrados.", x:null, y:10 },
                { tx: "üõ°Ô∏è Prevenci√≥n: Mantener la prohibici√≥n, pero enfocarse en educar para que la gente no consuma.", x:null, y:40 },
                { tx: "üåø Regularizaci√≥n: Legalizar la marihuana recreativa y cobrar impuestos, como con el alcohol.", x:null, y:75 },
                { tx: "üß™ Legalizaci√≥n total: El Estado debe regular todas las drogas para quitarle el negocio al narcotr√°fico.", x:null, y:95 }
            ] 
        },
        { 
            t: "8. ¬øC√≥mo mejorar la educaci√≥n en Colombia?", 
            o: [
                { tx: "üéüÔ∏è Bonos (Vouchers): Que el Estado le d√© un cheque a los padres para que paguen el colegio privado que quieran.", x:95, y:null },
                { tx: "ü§ù Sistema Mixto: Apoyar a los colegios privados de calidad y mejorar los p√∫blicos.", x:65, y:null },
                { tx: "üè´ Fortalecer lo P√∫blico: Todo el presupuesto debe ir a mejorar las universidades y colegios p√∫blicos.", x:30, y:null },
                { tx: "üéì Gratuidad Total: Educaci√≥n p√∫blica, gratuita y universal para todos, financiada 100% por el Estado.", x:5, y:null }
            ] 
        },
        { 
            t: "9. ¬øCu√°l es su posici√≥n sobre el aborto?", 
            o: [
                { tx: "üë∂ Pro-Vida Radical: Debe estar totalmente prohibido, sin ninguna excepci√≥n.", x:null, y:5 },
                { tx: "‚ö†Ô∏è Restringido: Solo permitirlo si la vida de la madre corre peligro o fue violaci√≥n.", x:null, y:40 },
                { tx: "‚öñÔ∏è Causales: Mantener las reglas actuales (libre hasta la semana 24) pero promover la adopci√≥n.", x:null, y:60 },
                { tx: "üíö Libre decisi√≥n: Es un derecho fundamental de la mujer decidir sobre su cuerpo sin restricciones.", x:null, y:95 }
            ] 
        },
        { 
            t: "10. ¬øQu√© opina de los impuestos?", 
            o: [
                { tx: "üìâ Bajar impuestos ya: Eliminar impuestos a las empresas para que inviertan y generen empleo.", x:100, y:null },
                { tx: "‚öñÔ∏è Moderados: Reducir la carga tributaria pero perseguir fuertemente a los evasores.", x:70, y:null },
                { tx: "üìà Progresivos: Que paguen m√°s impuestos las personas naturales m√°s ricas.", x:30, y:null },
                { tx: "üí∞ Altos al Capital: Impuestos fuertes al patrimonio, herencias y ganancias de los bancos.", x:5, y:null }
            ] 
        },
        { 
            t: "11. ¬øQu√© relaci√≥n debe tener la religi√≥n y la pol√≠tica?", 
            o: [
                { tx: "‚úùÔ∏è Estado Cristiano: Las leyes deben basarse en principios b√≠blicos y morales.", x:null, y:10 },
                { tx: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Tradicional: Defender la familia tradicional compuesta por hombre y mujer.", x:null, y:30 },
                { tx: "ü§ù Laico Respetuoso: Libertad de cultos, pero la religi√≥n no dicta las leyes.", x:null, y:70 },
                { tx: "üè≥Ô∏è‚Äçüåà Laico Radical: Separaci√≥n total. Garantizar derechos plenos a comunidades diversas y minor√≠as.", x:null, y:95 }
            ] 
        },
        { 
            t: "12. ¬øC√≥mo se debe manejar la protesta social?", 
            o: [
                { tx: "üö´ Cero Tolerancia: La polic√≠a debe despejar los bloqueos inmediatamente por la fuerza.", x:95, y:10 },
                { tx: "üõ°Ô∏è Orden: Se puede marchar, pero sin bloquear v√≠as ni hacer vandalismo.", x:70, y:40 },
                { tx: "üó£Ô∏è Di√°logo: Antes de enviar al ESMAD, el gobierno debe sentarse a negociar.", x:40, y:70 },
                { tx: "‚úä Garantista: La protesta es un derecho sagrado. Hay que desmontar el ESMAD y escuchar al pueblo.", x:10, y:95 }
            ] 
        },
        { 
            t: "13. ¬øQu√© hacer con las tierras y el campo?", 
            o: [
                { tx: "üöú Agroindustria: Respetar la propiedad privada y apoyar a los grandes empresarios del campo.", x:95, y:null },
                { tx: "üìà Productividad: Poner impuestos altos a las tierras que no produzcan nada.", x:60, y:null },
                { tx: "üí∞ Reforma Compra: Que el Estado compre tierras a precio comercial para d√°rselas a campesinos.", x:30, y:null },
                { tx: "üåæ Revoluci√≥n Agraria: Expropiar latifundios improductivos para repartirlos a quienes los trabajan.", x:5, y:null }
            ] 
        },
        { 
            t: "14. ¬øQu√© reforma necesita la justicia?", 
            o: [
                { tx: "‚öñÔ∏è Una sola Corte: Unificar las altas cortes para evitar choques de trenes.", x:80, y:20 },
                { tx: "üîí Mano Dura: Aumentar las penas y quitar beneficios de casa por c√°rcel.", x:70, y:30 },
                { tx: "üèõÔ∏è Independencia: Respetar la autonom√≠a de los jueces y darles m√°s recursos.", x:50, y:60 },
                { tx: "üó≥Ô∏è Elecci√≥n Popular: Que los jueces y fiscales sean elegidos por voto popular.", x:10, y:90 }
            ] 
        },
        { 
            t: "15. ¬øC√≥mo deben ser las relaciones laborales?", 
            o: [
                { tx: "‚è±Ô∏è Flexibilidad total: Contrataci√≥n por horas sin recargos para reducir el desempleo.", x:95, y:null },
                { tx: "ü§ù Acuerdos: Que trabajador y empresa pacten condiciones libremente.", x:70, y:null },
                { tx: "üõ°Ô∏è Protecci√≥n: Mantener las primas, cesant√≠as y recargos nocturnos actuales.", x:40, y:null },
                { tx: "‚úä Derechos Fuertes: Reducir la jornada laboral y aumentar el pago de horas extras.", x:5, y:null }
            ] 
        }
    ];

    let qIdx = 0, uX = 0, cX = 0, uY = 0, cY = 0;
    // Array para guardar coordenadas de cada respuesta individual para el desglose
    let userAnswers = [];

    function start() { document.getElementById('screen-start').classList.add('hidden'); document.getElementById('screen-quiz').classList.remove('hidden'); showQ(); }

    function showQ() {
        if(qIdx >= questions.length) { results(); return; }
        const q = questions[qIdx];
        document.getElementById('q-progress').innerText = `Pregunta ${qIdx+1}/15`;
        document.getElementById('q-text').innerText = q.t;
        const box = document.getElementById('options-box'); box.innerHTML = '';
        q.o.forEach(opt => {
            const b = document.createElement('button'); b.className = 'option-btn'; 
            b.innerHTML = `<span class="opt-icon">${opt.tx.split(':')[0]}</span><span style="display:block; font-size:0.9em; font-weight:400;">${opt.tx.split(':')[1] || ''}</span>`;
            b.onclick = () => { 
                // Acumular para promedio
                if(opt.x!=null){uX+=opt.x;cX++} 
                if(opt.y!=null){uY+=opt.y;cY++} 
                // Guardar respuesta individual para el desglose
                userAnswers.push({x: opt.x, y: opt.y});
                qIdx++; 
                showQ(); 
            };
            box.appendChild(b);
        });
    }

    function results() {
        document.getElementById('screen-quiz').classList.add('hidden');
        document.getElementById('screen-results').classList.remove('hidden');
        
        // 1. Calcular Promedio General
        const fX = cX?uX/cX:50, fY = cY?uY/cY:50;

        // 2. Calcular Afinidad General (Distancia al promedio)
        candidates.forEach(c => {
            const dist = Math.sqrt(Math.pow(c.x - fX, 2) + Math.pow(c.y - fY, 2));
            c.match = Math.max(0, 100 - (dist/1.4)).toFixed(0);
        });
        
        // Ordenar por afinidad para el Top 3
        const sortedForTop3 = [...candidates].sort((a,b) => b.match - a.match);

        // 3. CALCULO DE COINCIDENCIAS EXACTAS (Punto a punto)
        // Reiniciar contadores
        candidates.forEach(c => c.exactMatches = 0);
        
        userAnswers.forEach(ans => {
            // Si la respuesta tiene coordenadas nulas (ej: saltar pregunta), ignorar
            if (ans.x === null && ans.y === null) return;
            
            // Buscar cu√°l candidato est√° m√°s cerca de ESTA respuesta espec√≠fica
            let bestCandidate = null;
            let minDistance = Infinity;
            
            candidates.forEach(c => {
                // Usamos distancia euclidiana simple
                // Si la pregunta solo tenia eje Y (ej: aborto), comparamos solo Y. Si solo X, solo X.
                let dist = 0;
                if (ans.x !== null && ans.y !== null) {
                     dist = Math.sqrt(Math.pow(c.x - ans.x, 2) + Math.pow(c.y - ans.y, 2));
                } else if (ans.x !== null) {
                     dist = Math.abs(c.x - ans.x);
                } else if (ans.y !== null) {
                     dist = Math.abs(c.y - ans.y);
                }
                
                if (dist < minDistance) {
                    minDistance = dist;
                    bestCandidate = c;
                }
            });
            
            if (bestCandidate) {
                bestCandidate.exactMatches++;
            }
        });

        // Ordenar candidatos por n√∫mero de coincidencias exactas para el desglose
        const sortedForBreakdown = [...candidates].sort((a,b) => b.exactMatches - a.exactMatches);

        // --- RENDERIZAR GR√ÅFICO ---
        const layer = document.getElementById('dots-layer'); layer.innerHTML = '';
        const u = document.createElement('div'); u.className = 'dot user-dot';
        u.style.left = fX+'%'; u.style.top = (100-fY)+'%';
        const uLab = document.createElement('div'); uLab.className = 'label'; 
        uLab.innerText = "T√ö"; uLab.style.opacity = 1; u.appendChild(uLab);
        layer.appendChild(u);

        candidates.forEach(c => {
            const d = document.createElement('div'); d.className = 'dot';
            d.style.background = c.color; d.style.left = c.x+'%'; d.style.top = (100-c.y)+'%';
            const l = document.createElement('div'); l.className = 'label'; l.innerText = c.name;
            d.appendChild(l); layer.appendChild(d);
        });

        // --- RENDERIZAR DESGLOSE DE PUNTOS ---
        const breakdownBox = document.getElementById('breakdown-box');
        breakdownBox.innerHTML = '';
        sortedForBreakdown.forEach(c => {
            if(c.exactMatches > 0) { // Solo mostrar si tiene al menos 1 coincidencia
                breakdownBox.innerHTML += `
                    <div class="breakdown-item">
                        <span style="font-weight:bold; color:${c.color}">${c.name}</span>
                        <span class="breakdown-count">${c.exactMatches} coincidencias</span>
                    </div>
                `;
            }
        });

        // --- RENDERIZAR TOP 3 ---
        const list = document.getElementById('matches-box'); list.innerHTML = '';
        sortedForTop3.slice(0, 3).forEach(c => {
            list.innerHTML += `
                <div class="candidate-card">
                    <div class="match-badge">${c.match}%</div>
                    <h2 style="margin:0; color:${c.color}">${c.name}</h2>
                    <small style="font-weight:bold; color:#636e72;">${c.party}</small>
                    <div class="section-title" style="color:#FBC02D;">üìú Trayectoria</div>
                    <div class="box-trayectoria">${c.trayectoria}</div>
                    <div class="section-title" style="color:#4CAF50;">üì¢ Promesa</div>
                    <div class="box-promesa">${c.promesas}</div>
                </div>`;
        });
                // --- RENDERIZAR TARJETAS DE COINCIDENCIAS (pregunta a pregunta) ---
        const coincidencesBox = document.getElementById('coincidences-box');
        coincidencesBox.innerHTML = '';

        const candidatesWithCoincidences = sortedForBreakdown.filter(c => c.exactMatches > 0);

        candidatesWithCoincidences.forEach(c => {
            coincidencesBox.innerHTML += `
                <div class="candidate-card">
                    <div class="match-badge">${c.exactMatches} üéØ</div>
                    <h2 style="margin:0; color:${c.color}">${c.name}</h2>
                    <small style="font-weight:bold; color:#636e72;">${c.party}</small>
                    <div class="section-title" style="color:#FBC02D;">üìú Trayectoria</div>
                    <div class="box-trayectoria">${c.trayectoria}</div>
                    <div class="section-title" style="color:#4CAF50;">üì¢ Promesa</div>
                    <div class="box-promesa">${c.promesas}</div>
                </div>
            `;
        });

        if (candidatesWithCoincidences.length === 0) {
            coincidencesBox.innerHTML = `
                <div style="background:#f8f9fa; border:2px solid #eee; border-radius:16px; padding:16px; color:#666;">
                    No hubo coincidencias claras pregunta a pregunta (esto puede pasar si tus respuestas quedan siempre entre varios candidatos).
                </div>
            `;
        }




    }

    async function generatePDF() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById('printable-area');

    // Forzar labels visibles en el chart
    document.getElementById('chart').classList.add('printing-mode');
    await new Promise(r => setTimeout(r, 250));

    // Captura en alta resoluci√≥n
    const canvas = await html2canvas(element, {
        scale: 2,
        useCORS: true,
        backgroundColor: "#ffffff",
        scrollY: -window.scrollY
    });

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();

    // Convertimos altura de p√°gina PDF (mm) a px para ‚Äúrebanar‚Äù el canvas
    const pageHeightPx = Math.floor(canvas.width * (pdfHeight / pdfWidth));

    let y = 0;
    let page = 0;

    while (y < canvas.height) {
        // Alto del slice (√∫ltima p√°gina puede ser m√°s peque√±a)
        const sliceHeight = Math.min(pageHeightPx, canvas.height - y);

        // Canvas temporal para cada p√°gina
        const pageCanvas = document.createElement('canvas');
        pageCanvas.width = canvas.width;
        pageCanvas.height = sliceHeight;

        const ctx = pageCanvas.getContext('2d');
        ctx.drawImage(canvas, 0, y, canvas.width, sliceHeight, 0, 0, canvas.width, sliceHeight);

        const imgData = pageCanvas.toDataURL('image/png');

        // Alto en mm manteniendo proporci√≥n
        const imgHeightMm = (sliceHeight * pdfWidth) / canvas.width;

        if (page > 0) pdf.addPage();
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, imgHeightMm);

        y += sliceHeight;
        page++;
    }

    pdf.save('Votometro-2026-Resultados.pdf');

    document.getElementById('chart').classList.remove('printing-mode');
}

</script>

</body>
</html>